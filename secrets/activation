
# Activation script:
# Unpack secrets into the per-host locations, decrypting as we go.

MY_SECRETS="${HOME}/.local/allSecrets/$(hostname)"

if ! test -d "$MY_SECRETS"
then
  echo >&2 "No secrets available; skipping decryption."
  exit 0
fi

# Decrypt SSH keys.
# We need something a bit fancier to make it work.
# 
# The host key is (quite reasonably) locked to root, so what we really
# want is a chain:
# - Root decrypts a per-user keypair, puts it in /run/ with per-user ACLs
# - home-manager (running as the user) uses a per-user keypair
# 
# This will require some sort of a keymanager that we haven't written yet. :(

